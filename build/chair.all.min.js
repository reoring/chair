/*! chair 2013-05-28 */
var AllRowsSelected,AllRowsUnselected,Column,ColumnFormat,ColumnUpdated,DomainEvent,DomainRegistry,ExcelMoveMode,Grid,GridChangeService,GridChanged,GridRepository,GridService,InMemoryRowContainer,JQueryAjaxRowRepository,MoveModeFactory,Row,RowAppended,RowRemoved,RowRepository,RowSelected,RowUnselected,SequenceMoveMode,Table,TableUIHelper,ViewController,ViewEvent,ViewFilterChanged,ViewSortChanged,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Column=function(){function a(a,b,c){null==c&&(c=[]),this.id=a,this.name=b,this.formats=c}return a.prototype.format=function(a){var b,c,d,e;for(a=this.escapeHTML(a),e=this.formats,c=0,d=e.length;d>c;c++)b=e[c],a=b.format(a);return a},a.prototype.escapeHTML=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},a}(),ColumnFormat=function(){function a(a){this.formatter=a}return a.prototype.format=function(a){return this.formatter(a)},a}(),DomainEvent={channels:{"*":[]},publish:function(a,b){var c,d,e,f,g,h,i,j;a in this.channels||(this.channels[a]=[]),c=b.serialize(),i=this.channels["*"];for(e=0,g=i.length;g>e;e++)d=i[e],d(c,a);for(j=this.channels[a],f=0,h=j.length;h>f;f++)d=j[f],d(c,a);return null},subscribe:function(a,b){return a in this.channels||(this.channels[a]=[]),this.channels[a].push(b),null}},DomainRegistry={_gridRepository:null,_rowRepository:null,gridRepository:function(){return null===this._gridRepository&&(this._gridRepository=new GridRepository),this._gridRepository},rowRepository:function(){if(!this._rowRepository)throw new Error("Row Repository has not been initialized");return this._rowRepository},setRowRepository:function(a){this._rowRepository=a},gridChangeService:function(){return new GridChangeService}},Grid=function(){function a(a,b){var d,e,f;if(this.id=a,!this.id)throw new Error("Grid ID is required");for(this._rows={},this.columns=[],e=0,f=b.length;f>e;e++)d=b[e],this.columns.push(d);this.selectionStatus=c}var b,c;return c=0,b=1,a.prototype.selectAllRows=function(){return this.selectionStatus=b,DomainEvent.publish("AllRowsSelected",new AllRowsSelected(this.id)),null},a.prototype.unselectAllRows=function(){return this.selectionStatus=c,DomainEvent.publish("AllRowsUnselected",new AllRowsUnselected(this.id)),null},a.prototype.append=function(a){if(this._hasRow(a.id))throw new Error("Row(id:"+a.id+") already exists in the Grid(id:"+this.id+")");return this._addRow(a),DomainEvent.publish("RowAppended",new RowAppended(this.id,a.id,a.columns))},a.prototype.updateColumn=function(a,b,c){return this._hasRow(a)?this._getRow(a).updateColumn(b,c,this.id):void 0},a.prototype.rows=function(){var a,b;return function(){var c,d;c=this._rows,d=[];for(a in c)__hasProp.call(c,a)&&(b=c[a],d.push(b));return d}.call(this)},a.prototype.change=function(a,b,c,d,e){var f,g,h;for(this._rows={},g=0,h=a.length;h>g;g++)f=a[g],this._addRow(f);return DomainEvent.publish("GridChanged",new GridChanged(this.id,a,b,c,d,e))},a.prototype.removeRow=function(a){return this._hasRow(a)?(this._getRow(a).remove(),delete this._rows[a]):void 0},a.prototype.allRowSelected=function(){return this.selectionStatus===b},a.prototype._hasRow=function(a){return this._rows[a]?!0:!1},a.prototype._getRow=function(a){return this._rows[a]},a.prototype._addRow=function(a){return this._rows[a.id]=a,a.gridId=this.id},a}(),RowAppended=function(){function a(a,b,c){var d,e;if(this.gridId=a,this.rowId=b,!this.gridId)throw new Error("Grid ID is required");if(!this.rowId)throw new Error("Row ID is required");if(!c)throw new Error("Column Values are required");this.columns=[];for(d in c)e=c[d],this.columns.push(e)}return a.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId,columns:this.columns}},a}(),AllRowsSelected=function(){function a(a){if(this.gridId=a,!this.gridId)throw new Error("Grid ID is required")}return a.prototype.serialize=function(){return{gridId:this.gridId}},a}(),AllRowsUnselected=function(){function a(a){if(this.gridId=a,!this.gridId)throw new Error("Grid ID is required")}return a.prototype.serialize=function(){return{gridId:this.gridId}},a}(),GridChanged=function(){function a(a,b,c,d,e,f){var g,h,i;if(this.gridId=a,this.page=c,this.total=d,this.rowsPerGrid=e,this.filter=f,!this.gridId)throw new Error("Grid ID is required");if(!b)throw new Error("Rows are required");for(this.rows=[],h=0,i=b.length;i>h;h++)g=b[h],this.rows.push({id:g.id,columns:g.columns,selected:g.selected,updatedColumns:g.updatedColumns})}return a.prototype.page=function(){return this.page},a.prototype.total=function(){return this.total},a.prototype.filter=function(){return this.filter},a.prototype.serialize=function(){return{gridId:this.gridId,rows:this.rows,page:this.page,total:this.total,rowsPerGrid:this.rowsPerGrid,filter:this.filter}},a}(),GridChangeService=function(){function a(){}return a.prototype.change=function(a,b,c,d){if(!a)throw new Error("Grid ID is required");if(!b)throw new Error("Page is required");if(!c)throw new Error("Rows Per Grid is required");return DomainRegistry.gridRepository().gridOfId(a,function(a,e){var f;if(a)throw new Error(a);if(null!==e)return f={gridId:e.id,page:b,rowsPerGrid:c,filter:d},DomainRegistry.rowRepository().rowsSpecifiedBy(f,function(a,b){if(a)throw new Error(a);return void 0!==f.filter&&(d=JSON.parse(f.filter)),e.change(b.rows,f.page,b.total,f.rowsPerGrid,d)})}),null},a}(),GridRepository=function(){function a(a){var b,c,d;for(null==a&&(a=[]),this.grids={},c=0,d=a.length;d>c;c++)b=a[c],this.add(b)}return a.prototype.gridOfId=function(a,b){return this.grids[a]?b(null,this.grids[a]):(b(null,null),void 0)},a.prototype.add=function(a){return this.grids[a.id]=a},a}(),Row=function(){function a(a,b,c){var d,e,f=this;this.id=a,this.gridId=null!=c?c:null,this.columns={};for(d in b)__hasProp.call(b,d)&&(e=b[d],this.columns[d]=""+e);this.deleted=!1,this.selected=!1,this.updatedColumns=[],DomainEvent.subscribe("AllRowsSelected",function(a){return a.gridId===f.gridId?f.select():void 0}),DomainEvent.subscribe("AllRowsUnselected",function(a){return a.gridId===f.gridId?f.unselect():void 0})}return a.prototype.updateColumn=function(a,b){if(a in this.columns){if(this.columns[a]===b)return null;this.columns[a]=b,this.updatedColumns.push(a),DomainEvent.publish("ColumnUpdated",new ColumnUpdated(this.gridId,this.id,a,b))}return null},a.prototype.remove=function(){return this.deleted=!0,DomainEvent.publish("RowRemoved",new RowRemoved(this.gridId,this.id)),null},a.prototype.select=function(){return this.selected===!1&&(this.selected=!0,DomainEvent.publish("RowSelected",new RowSelected(this.gridId,this.id))),null},a.prototype.unselect=function(){return this.selected===!0&&(this.selected=!1,DomainEvent.publish("RowUnselected",new RowUnselected(this.gridId,this.id))),null},a}(),ColumnUpdated=function(){function a(a,b,c,d){if(this.gridId=a,this.rowId=b,this.columnId=c,this.columnValue=d,!this.gridId)throw new Error("Grid ID is required");if(!this.rowId)throw new Error("Row ID is reuqired");if(!this.columnId)throw new Error("Column ID is required");if(null==this.columnValue)throw new Error("Column Value is required")}return a.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId,columnId:this.columnId,columnValue:this.columnValue}},a}(),RowRemoved=function(){function a(a,b){if(this.gridId=a,this.rowId=b,!this.gridId)throw new Error("Grid ID is required");if(!this.rowId)throw new Error("Row ID is required")}return a.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},a}(),RowSelected=function(){function a(a,b){if(this.gridId=a,this.rowId=b,!this.gridId)throw new Error("Grid ID is required");if(!this.rowId)throw new Error("Row ID is required")}return a.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},a}(),RowUnselected=function(){function a(a,b){if(this.gridId=a,this.rowId=b,!this.gridId)throw new Error("Grid ID is required");if(!this.rowId)throw new Error("Row ID is required")}return a.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},a}(),RowRepository=function(){function a(){}return a.prototype.add=function(){},a.prototype.rowOfId=function(){},a}(),JQueryAjaxRowRepository=function(a){function b(a){this.ajaxURL=a,this.gridContainer=new InMemoryRowContainer}return __extends(b,a),b.prototype.add=function(a){if(!a.id)throw new Error("Row ID is not specified");if(!a.gridId)throw new Error("Grid ID is not specified");return this.gridContainer.add(a)},b.prototype.rowOfId=function(a,b,c){var d;return a||c("Missing argument: gridId",null),b||c("Missing argument: rowId",null),d=this.gridContainer.get(a,b),d instanceof Row?c(null,d):c(null,null)},b.prototype.rowsSpecifiedBy=function(a,b){var c=this;return $.ajax({url:this.ajaxURL,data:{id:a.gridId,page:a.page,rowsPerGrid:a.rowsPerGrid,filter:a.filter},dataType:"json",success:function(a){var d,e,f,g,h,i,j,k,l,m,n,o;if("object"!=typeof a)return b("Response is not object",null);if(!("id"in a))return b("Invalid scheme: gridId is missing",null);if(!("rows"in a))return b("Invalid scheme: rows is missing",null);if(!("total"in a))return b("Invalid scheme: total is missing",null);for(n=a.rows,j=0,l=n.length;l>j;j++)if(f=n[j],!f.id)return b("Row id is missing: "+JSON.stringify(f),null);for(d=a.id,h=a.rows,i=[],o=a.rows,k=0,m=o.length;m>k;k++)g=o[k],c.gridContainer.addByData(d,g),f=c.gridContainer.get(d,g.id),i.push(f);return e={gridId:d,rows:i,total:a.total},b(null,e),null},error:function(a,c,d){return b(d,null)}})},b}(RowRepository),InMemoryRowContainer=function(){function a(){this.grids={}}return a.prototype.addByData=function(a,b){var c,d,e=this;if(!a)throw new Error("Grid ID is required");if(!(b instanceof Object))throw new Error("Row data must be instance of Object");if(b instanceof Row)throw new Error("Row data must NOT be instance of Row");if(!b.id)throw new Error('Row must contain "id" key');return d=b.id,this._rowExists(a,d)?void 0:(c=this._removeIdFromColumns(b,"id"),DomainRegistry.gridRepository().gridOfId(a,function(b,f){var g;if(b)throw new Error("Failed to find Grid");if(!(f instanceof Grid))throw new Error("Grid not found");return g=new Row(d,c,a),g.selected=f.allRowSelected()?!0:!1,e.add(g)}),null)},a.prototype.add=function(a){var b,c;if(!(a instanceof Row))throw new Error("Row must be instanceof Row");if(!a.id)throw new Error("Row ID is required");if(!a.gridId)throw new Error("Row grid ID is required");return b=a.gridId,c=a.id,void 0===this.grids[b]&&(this.grids[b]={}),this.grids[b][c]=a,null},a.prototype.get=function(a,b){if(!a)throw new Error("Grid ID is required");if(!b)throw new Error("Row ID is required");return this._rowExists(a,b)?this.grids[a][b]:null},a.prototype._rowExists=function(a,b){var c;return null!=(null!=(c=this.grids[a])?c[b]:void 0)},a.prototype._removeIdFromColumns=function(a,b){var c,d,e;c={};for(d in a)__hasProp.call(a,d)&&(e=a[d],d===b||(c[d]=e));return c},a}(),GridService=function(){function a(){}return a.prototype.startup=function(a,b,c){var d,e,f,g,h,i;if(!a)throw new Error("Grid ID is required");if(!b)throw new Error("Columns Config are required");if(!c)throw new Error("Ajax URL is required");for(b=JSON.parse(b),d=[],h=0,i=b.length;i>h;h++)e=b[h],f=[],d.push(new Column(e.id,e.title,f));return g=new Grid(a,d),DomainRegistry.gridRepository().add(g),DomainRegistry.setRowRepository(new JQueryAjaxRowRepository(c)),null},a.prototype.select=function(a,b){return DomainRegistry.rowRepository().rowOfId(a,b,function(a,b){if(a)throw new Error(a);return null===b?null:b.select()}),null},a.prototype.unselect=function(a,b){return DomainRegistry.rowRepository().rowOfId(a,b,function(a,b){if(a)throw new Error(a);return null===b?null:b.unselect()}),null},a.prototype.selectAll=function(a){return DomainRegistry.gridRepository().gridOfId(a,function(a,b){if(a)throw new Error(a);return null===b?null:b.selectAllRows()}),null},a.prototype.unselectAll=function(a){return DomainRegistry.gridRepository().gridOfId(a,function(a,b){if(a)throw new Error(a);return null===b?null:b.unselectAllRows()}),null},a.prototype.append=function(a,b,c){return DomainRegistry.gridRepository().gridOfId(a,function(a,d){if(a)throw new Error(a);return null===d?null:d.append(new Row(b,c))}),null},a.prototype.updateColumn=function(a,b,c,d){return DomainRegistry.gridRepository().gridOfId(a,function(a,e){if(a)throw new Error(a);return null===e?null:e.updateColumn(b,c,d)}),null},a.prototype.removeRow=function(a,b){return DomainRegistry.gridRepository().gridOfId(a,function(a,c){if(a)throw new Error(a);return null===c?null:c.removeRow(b)}),null},a.prototype.change=function(a,b,c,d){if(!a)throw new Error("Grid ID is required");if(!b)throw new Error("Page is required");if(!c)throw new Error("Rows Per Grid is required");return DomainRegistry.gridChangeService().change(a,b,c,d),null},a}(),Table=function(){function a(a,b,c,d,e){var f=this;this.tableId=a,this.table=b,this.moveMode=c,this.gridService=d,this.rows={},this.rowsById={},this.numberOfRows=0,this.columnConfig=JSON.parse(e),this.currentCursor=void 0,$(document).on("keydown",function(a){var b,c,d;if(b=f.findRow(f.currentCursor),0!==b.length)if(32===a.which&&(a.preventDefault(),d=b.attr("data-id").split(".")[2],b.hasClass("row_selected")?f.gridService.unselect(f.tableId,d):f.gridService.select(f.tableId,d)),40===a.which){if(a.preventDefault(),c=b.next(),0!==c.length)return f.cursorRow(c.attr("data-id"))}else if(38===a.which&&(a.preventDefault(),c=b.prev(),0!==c.length))return f.cursorRow(c.attr("data-id"))})}return a.prototype.reset=function(){return this.rows={},this.rowsById={},this.numberOfRows=0,this.currentCursor=void 0},a.prototype.selector=function(){return this.table.selector},a.prototype.header=function(a){var b,c,d,e,f,g,h,i,j;for(this.columns=a,c=$("<tr></tr>"),"function"==typeof(f=this.moveMode).beforeHeader&&f.beforeHeader(c),j=this.columns,h=0,i=j.length;i>h;h++)b=j[h],e=$("<th></th>").attr("data-column-id",b.id),e.on("click",function(){var a,b;return a=$(this).attr("data-column-id"),b=$(this).find("i"),b.hasClass("icon-caret-down")?(b.removeClass(),$(this).parents("tr").find("i").each(function(a,b){return $(b).removeClass()}),b.addClass("icon-caret-up"),ViewEvent.publish("ViewSortChanged",new ViewSortChanged(a,"asc"))):(b.removeClass(),$(this).parents("tr").find("i").each(function(a,b){return $(b).removeClass()}),b.addClass("icon-caret-down"),ViewEvent.publish("ViewSortChanged",new ViewSortChanged(a,"desc")))}),d=$("<span></span>"),d.append(b.title),d.append($("<i></i>")),c.append(e.append(d)),this.table.find("thead").append(c);return"function"==typeof(g=this.moveMode).afterHeader?g.afterHeader(c):void 0},a.prototype.get=function(a){return this.rows[a]},a.prototype.getById=function(a){return this.rowsById[a]},a.prototype.removeById=function(a){var b;return this.findRow(a).remove,b=this.getById(a),delete this.rowsById[a],b},a.prototype.updateById=function(a,b){var c,d,e,f,g,h,i;for(d=this.rowIdOfGlobal(a),e=$("<tr></tr>").attr("data-id",d),f=$(this.table).find('tr[data-id="'+d+'"]'),this.getById(d=b),c=0,h=0,i=b.length;i>h;h++)g=b[h],e.append(this.createRowColumn(this.columns[c],g)),c++;return f.html(e.html())},a.prototype.cursorTop=function(){var a;return a=this.get(0),this.cursorRow(this.rowIdOfGlobal(a.id))},a.prototype.cursorRow=function(a){return void 0===this.currentCursor?this.addClassToRow(a,"current"):(this.removeClassFromRow(this.currentCursor,"current"),this.addClassToRow(a,"current")),this.currentCursor=a},a.prototype.rowIdOfGlobal=function(a){return this.tableId+"."+a},a.prototype.insert=function(a,b){var c,d,e,f,g,h,i,j;for(void 0===b&&(b=this.guid()),d=this.rowIdOfGlobal(b),e=$("<tr></tr>").attr("data-id",d),"function"==typeof(f=this.moveMode).beforeInsert&&f.beforeInsert(b,e),this.rows[this.numberOfRows++]={id:b,data:a},this.rowsById[b]=a,j=this.columnConfig,h=0,i=j.length;i>h;h++)c=j[h],e.append(this.createRowColumn(c,a[c.id]));return this.table.find("tbody").append(e),"function"==typeof(g=this.moveMode).afterInsert?g.afterInsert(b,e):void 0},a.prototype.filterRowExists=function(){return console.log(this.table.find("tbody tr.filter").length),0!==this.table.find("tbody tr.filter").length},a.prototype.setFilterRow=function(a){var b,c,d,e,f,g;for(void 0===a&&(a={}),c=$("<tr></tr>").addClass("filter"),"function"==typeof(d=this.moveMode).beforeInsert&&d.beforeInsert(void 0,c),g=this.columnConfig,e=0,f=g.length;f>e;e++)b=g[e],c.append(this.createFilterColumn(b,a[b.id]));return this.table.find("tbody").append(c)},a.prototype.createRowColumn=function(a,b){var c;return c=$("<td></td>"),c.addClass(a).attr("data-column",a.id),c.attr("data-column-editable",a.editable),a.editable===!1&&c.addClass("disabled"),c.append($("<span></span>").append(b))},a.prototype.createFilterColumn=function(a,b){var c,d,e=this;return d=$("<td></td>"),c=$("<input></input>").attr("type","text").attr("data-filter-column",a.id).val(b).addClass("filter_input"),c.on("keyup",function(){return window.clearTimeout(e.timeoutID),e.timeoutID=setTimeout(function(){var a;return a=[],$(".filter_input").each(function(c,d){var e;return e=$(d).attr("data-filter-column"),b=$(d).val(),a.push({columnId:e,value:b})}),ViewEvent.publish("ViewFilterChanged",new ViewFilterChanged(a))},450)}),d.append(c)},a.prototype.selectRow=function(a,b){var c,d;return"function"==typeof(c=this.moveMode).beforeRowSelect&&c.beforeRowSelect(a),this.addClassToRow(this.rowIdOfGlobal(a),b),"function"==typeof(d=this.moveMode).afterRowSelect?d.afterRowSelect(a):void 0},a.prototype.unselectRow=function(a,b){var c,d;return"function"==typeof(c=this.moveMode).beforeRowUnselect&&c.beforeRowUnselect(a),this.removeClassFromRow(this.rowIdOfGlobal(a),b),"function"==typeof(d=this.moveMode).afterRowUnselect?d.afterRowUnselect(a):void 0},a.prototype.addClassToRow=function(a,b){var c;return c=$(this.findRow(a)),c.hasClass(b)?void 0:c.addClass(b)},a.prototype.addClassToColumn=function(a,b,c){var d,e;return e=this.findRow(a),d=e.find('td[data-column="'+b+'"]'),d.addClass(c)},a.prototype.removeClassFromRow=function(a,b){return this.findRow(a).removeClass(b)},a.prototype.removeAllRows=function(){return this.reset(),this.table.find("tbody").html("")},a.prototype.removeAllRowsWithout=function(a){return this.reset(),this.table.find("tbody tr").each(function(b,c){return $(c).hasClass(a)?void 0:$(c).remove()})},a.prototype.removeAllClassesFromRow=function(a){var b;return b=this.findRow(a),b.removeClass()},a.prototype.toggleClassToRow=function(a,b){return this.findRow(a).toggleClass(b)},a.prototype.hasClassOfRow=function(a,b){return this.findRow(a).hasClass(b)},a.prototype.findRow=function(a){return $(this.table).find('tr[data-id="'+a+'"]')},a.prototype.listen=function(a,b,c){return this.findRow(a).on(b,function(){return c(a,$(this))})},a.prototype.listenRowEvent=function(a,b){return this.table.on(a,"tr",function(){var a;return a=$(this).attr("data-id"),b(a,$(this))})},a.prototype.toRowEdit=function(a){var b;return b=this.findRow(a)},a.prototype.toCellEdit=function(a,b){var c,d;return d=this.findRow(a),c=d.find('td[data-column="'+b+'"]'),this.isCellEditable(c)?this._editCell(c):void 0},a.prototype.isCellEditable=function(a){return"true"===a.attr("data-column-editable")},a.prototype._editPreviousCell=function(a){return a=this.searchEditableColumnToBackward(a),a===!1?!1:this.isCellEditable(a)?this._editCell(a):void 0},a.prototype.searchEditableColumnToBackward=function(a,b){var c,d,e;return null==b&&(b=1),b>20?!1:(e=a.prev(),this.isCellEditable(e)?e:0===e.length&&(d=a.parent().prev(),c=d.children().length,e=$(d.children()[c-1]),this.isCellEditable(e))?e:this.searchEditableColumnToBackward(e,b+1))},a.prototype.searchEditableColumnToForward=function(a,b){var c,d;return null==b&&(b=1),b>20?!1:(c=a.next(),this.isCellEditable(c)?c:0===c.length&&(d=a.parent().next(),c=$(d.children()[0]),this.isCellEditable(c))?c:this.searchEditableColumnToForward(c,b+1))},a.prototype._editNextCell=function(a){return a=this.searchEditableColumnToForward(a),a===!1?!1:this.isCellEditable(a)?this._editCell(a):void 0},a.prototype._editCell=function(a){var b,c;return a===!1?!1:(b=$('<input type="text"></input>').addClass("inline_edit").val(a.text()),TableUIHelper.fitInputToCell(b,a),a.find("span").replaceWith(b),b.select(),"function"==typeof(c=this.moveMode).move?c.move(b,a):void 0)},a.prototype.listenCellEvent=function(a,b){return this.table.on(a,"td",function(){var a;return a=$(this).parents("tr").attr("data-id"),b(a,$(this))})},a.prototype.listenTextEvent=function(a,b){return this.table.find("span").on(a,function(){var a;return a=$(this).parents("tr").attr("data-id"),b(a,$(this)),!1})},a.prototype.s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},a.prototype.guid=function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},a}(),ViewFilterChanged=function(){function a(a){this.filterConditions=a}return a.prototype.serialize=function(){var a,b,c,d,e;for(b={},e=this.filterConditions,c=0,d=e.length;d>c;c++)a=e[c],b[a.columnId]=a.value;return b},a}(),ViewSortChanged=function(){function a(a,b){this.columnId=a,this.direction=b}return a.prototype.serialize=function(){return{columnId:this.columnId,direction:this.direction}},a}(),TableUIHelper=function(){function a(){}return a.fitInputToCell=function(a,b){var c,d,e,f,g,h,i,j,k;return i=parseInt(b.css("paddingLeft"),10),j=parseInt(b.css("paddingRight"),10),k=parseInt(b.css("paddingTop"),10),h=parseInt(b.css("paddingBottom"),10),e=parseInt(b.css("borderLeft"),10),f=parseInt(b.css("borderRight"),10),g=parseInt(b.css("borderTop"),10),d=parseInt(b.css("borderBottom"),10),c=2,a.css("marginLeft",-1*i),a.css("marginRight",-1*j),a.css("marginTop",-1*(k+g+c)),a.css("marginBottom",-1*h),a.width(b.width()+i+j),a.height(b.height()+k+h+g)},a}(),ExcelMoveMode=function(){function a(){}return a.prototype.init=function(a,b,c){var d=this;return this.table=a,this.applicationGridService=b,this.rowSelectedClass=c,this.table.listenCellEvent("click",function(a,b){var c;return c=b.attr("data-column"),d.table.toCellEdit(a,c)})},a.prototype.beforeHeader=function(a){var b,c=this;return b=$("<input></input>").attr("type","checkbox"),b.on("click",function(){var a;return a=$(c),a.prop("checked")?(c.applicationGridService.unselectAll(c.table.tableId),a.prop("checked",!1)):(c.applicationGridService.selectAll(c.table.tableId),a.prop("checked",!0))}),a.append($("<th></th>").append(b))},a.prototype.beforeInsert=function(a,b){var c,d=this;return void 0===a?(b.append($("<td></td>")),void 0):(c=$("<input></input>").attr("type","checkbox"),c.attr("data-row-id",a),c.on("click",function(){return d.table.hasClassOfRow(d.table.rowIdOfGlobal(a),d.rowSelectedClass)?d.applicationGridService.unselect(d.table.tableId,a):d.applicationGridService.select(d.table.tableId,a)}),b.append($("<td></td>").append(c)))},a.prototype.beforeRowSelect=function(a){return $('input[data-row-id="'+a+'"]').prop("checked",!0)},a.prototype.beforeRowUnselect=function(a){return $('input[data-row-id="'+a+'"]').prop("checked",!1)},a.prototype.move=function(a,b){var c,d,e,f=this;return e=this.table.tableId,b.parents().length>0&&(d=b.parents().attr("data-id").split(".")[2]),c=b.attr("data-column"),a.on("keydown",function(g){var h,i,j,k,l;return 9===g.which&&(g.preventDefault(),l=a.val(),f.applicationGridService.updateColumn(e,d,c,l),a.replaceWith($("<span></span>").text(l)),g.shiftKey===!0?f.table._editPreviousCell(b):f.table._editNextCell(b)),13===g.which?(a.replaceWith($("<span></span>").text(a.val())),l=a.val(),f.applicationGridService.updateColumn(e,d,c,l),g.shiftKey===!0?(k=$(b.parent().prev()),j=k.find('td[data-column="'+b.attr("data-column")+'"]'),f.table._editCell(j)):(i=$(b.parent().next()),h=i.find('td[data-column="'+b.attr("data-column")+'"]'),f.table._editCell(h))):void 0}),a.on("blur",function(){var b;return b=a.val(),f.applicationGridService.updateColumn(e,d,c,b),a.replaceWith($("<span></span>").text(a.val()))})},a}(),MoveModeFactory=function(){function a(){}return a.classes={excel:ExcelMoveMode,sequence:SequenceMoveMode},a.create=function(a){return new this.classes[a]},a}(),SequenceMoveMode=function(){function a(){}return a.prototype.move=function(a,b,c){return a.on("keypress",function(d){return 13===d.which?(a.replaceWith($("<span></span>").text(a.val())),0===b.next().length?c._editCell($(b.parent().next().find("td")[0])):c._editCell(b.next())):void 0}),a.on("blur",function(){return a.replaceWith($("<span></span>").text(a.val()))})},a}(),ViewController=function(){function a(a,b,c,d,e,f){this.gridId=a,this.columnConfigJSON=b,this.tableSelector=d,this.rowSelectedClass=null!=e?e:"row_selected",this.moveModeName=f,this.rowModifiedClass="row_modified",this.applicationGridService=new GridService,this.applicationGridService.startup(this.gridId,b,c)}return a.prototype.startup=function(a,b){var c,d=this;return this.page=a,this.rowsPerGrid=b,c=MoveModeFactory.create(this.moveModeName),this.table=new Table(this.gridId,$(this.tableSelector),c,this.applicationGridService,this.columnConfigJSON),this.table.header(JSON.parse(this.columnConfigJSON)),c.init(this.table,this.applicationGridService,this.rowSelectedClass),this.applicationGridService.change(this.gridId,a,b),this.table.filterRowExists()||this.table.setFilterRow(),DomainEvent.subscribe("GridChanged",function(a){var b,c,e,f,g,h,i,j;if(d.table.removeAllRowsWithout("filter"),a.gridId===d.gridId)for(i=a.rows,e=0,g=i.length;g>e;e++)for(c=i[e],d.table.insert(c.columns,c.id),c.selected===!0&&d.table.selectRow(c.id,d.rowSelectedClass),j=c.updatedColumns,f=0,h=j.length;h>f;f++)b=j[f],d.table.addClassToColumn(d.table.rowIdOfGlobal(c.id),b,"column_modified");return d.cursor()}),DomainEvent.subscribe("ColumnUpdated",function(a){return d.table.addClassToColumn(d.table.rowIdOfGlobal(a.rowId),a.columnId,"column_modified")}),DomainEvent.subscribe("RowAppended",function(a){return a.gridId===d.gridId?d.table.insert(a.columns,a.rowId):void 0}),DomainEvent.subscribe("RowSelected",function(a){return a.gridId===d.gridId?d.table.selectRow(a.rowId,d.rowSelectedClass):void 0}),DomainEvent.subscribe("RowUnselected",function(a){return a.gridId===d.gridId?d.table.unselectRow(a.rowId,d.rowSelectedClass):void 0}),ViewEvent.subscribe("ViewFilterChanged",function(a){return d.applicationGridService.change(d.gridId,d.page,d.rowsPerGrid,JSON.stringify(a))})},a.prototype.add=function(a,b){return this.applicationGridService.append(this.gridId,a,b)},a.prototype.selectAll=function(){return this.applicationGridService.selectAll(this.gridId)},a.prototype.unselectAll=function(){return this.applicationGridService.unselectAll(this.gridId)},a.prototype.movePageTo=function(a){return this.page=a,this.applicationGridService.change(this.gridId,this.page,this.rowsPerGrid)},a.prototype.cursor=function(a){return void 0!==a&&this.table.cursorRow(a),this.table.cursorTop()},a}(),ViewEvent={channels:{"*":[]},publish:function(a,b){var c,d,e,f,g,h,i,j;a in this.channels||(this.channels[a]=[]),c=b.serialize(),i=this.channels["*"];for(e=0,g=i.length;g>e;e++)d=i[e],d(c,a);for(j=this.channels[a],f=0,h=j.length;h>f;f++)d=j[f],d(c,a);return null},subscribe:function(a,b){return a in this.channels||(this.channels[a]=[]),this.channels[a].push(b),null}};