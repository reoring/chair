/*! chair 2013-06-10 */
var AllRowsSelected,AllRowsUnselected,Column,ColumnFormat,ColumnUpdated,DomainEvent,DomainRegistry,ExcelMoveMode,Grid,GridChangeService,GridChanged,GridRepository,GridService,InMemoryRowContainer,JQueryAjaxRowRepository,MoveModeFactory,Row,RowAppended,RowRemoved,RowRepository,RowSaved,RowSelected,RowUnselected,SequenceMoveMode,Table,TableUIHelper,ViewController,ViewEvent,ViewFilterChanged,ViewSortChanged,__hasProp={}.hasOwnProperty,__extends=function(t,r){function e(){this.constructor=t}for(var i in r)__hasProp.call(r,i)&&(t[i]=r[i]);return e.prototype=r.prototype,t.prototype=new e,t.__super__=r.prototype,t};Column=function(){function t(t,r,e){null==e&&(e=[]),this.id=t,this.name=r,this.formats=e}return t.prototype.format=function(t){var r,e,i,o;for(t=this.escapeHTML(t),o=this.formats,e=0,i=o.length;i>e;e++)r=o[e],t=r.format(t);return t},t.prototype.escapeHTML=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},t}(),ColumnFormat=function(){function t(t){this.formatter=t}return t.prototype.format=function(t){return this.formatter(t)},t}(),DomainEvent={channels:{"*":[]},publish:function(t,r){var e,i,o,n,s,d,l,u;t in this.channels||(this.channels[t]=[]),e=r.serialize(),l=this.channels["*"];for(o=0,s=l.length;s>o;o++)i=l[o],i(e,t);for(u=this.channels[t],n=0,d=u.length;d>n;n++)i=u[n],i(e,t);return null},subscribe:function(t,r){return t in this.channels||(this.channels[t]=[]),this.channels[t].push(r),null}},DomainRegistry={_gridRepository:null,_rowRepository:null,gridRepository:function(){return null===this._gridRepository&&(this._gridRepository=new GridRepository),this._gridRepository},rowRepository:function(){if(!this._rowRepository)throw Error("Row Repository has not been initialized");return this._rowRepository},setRowRepository:function(t){return null===this._rowRepository?this._rowRepository=t:void 0},gridChangeService:function(){return new GridChangeService}},Grid=function(){function t(t,r){var i,o,n;if(this.id=t,!this.id)throw Error("Grid ID is required");for(this._rows={},this.columns=[],o=0,n=r.length;n>o;o++)i=r[o],this.columns.push(i);this.selectionStatus=e}var r,e;return e=0,r=1,t.prototype.selectAllRows=function(){return this.selectionStatus=r,DomainEvent.publish("AllRowsSelected",new AllRowsSelected(this.id)),null},t.prototype.unselectAllRows=function(){return this.selectionStatus=e,DomainEvent.publish("AllRowsUnselected",new AllRowsUnselected(this.id)),null},t.prototype.append=function(t){if(this._hasRow(t.id))throw Error("Row(id:"+t.id+") already exists in the Grid(id:"+this.id+")");return this._addRow(t),DomainEvent.publish("RowAppended",new RowAppended(this.id,t.id,t.columns))},t.prototype.updateColumn=function(t,r,e){return this._hasRow(t)?this._getRow(t).updateColumn(r,e,this.id):void 0},t.prototype.rows=function(){var t,r;return function(){var e,i;e=this._rows,i=[];for(t in e)__hasProp.call(e,t)&&(r=e[t],i.push(r));return i}.call(this)},t.prototype.change=function(t,r,e,i,o){var n,s,d;for(this._rows={},s=0,d=t.length;d>s;s++)n=t[s],this._addRow(n);return DomainEvent.publish("GridChanged",new GridChanged(this.id,t,r,e,i,o))},t.prototype.removeRow=function(t){return this._hasRow(t)?(this._getRow(t).remove(),delete this._rows[t]):void 0},t.prototype.allRowSelected=function(){return this.selectionStatus===r},t.prototype._hasRow=function(t){return this._rows[t]?!0:!1},t.prototype._getRow=function(t){return this._rows[t]},t.prototype._addRow=function(t){return this._rows[t.id]=t,t.gridId=this.id},t}(),RowAppended=function(){function t(t,r,e){var i,o;if(this.gridId=t,this.rowId=r,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is required");if(!e)throw Error("Column Values are required");this.columns=[];for(i in e)o=e[i],this.columns.push(o)}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId,columns:this.columns}},t}(),AllRowsSelected=function(){function t(t){if(this.gridId=t,!this.gridId)throw Error("Grid ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId}},t}(),AllRowsUnselected=function(){function t(t){if(this.gridId=t,!this.gridId)throw Error("Grid ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId}},t}(),GridChanged=function(){function t(t,r,e,i,o,n){var s,d,l;if(this.gridId=t,this.page=e,this.total=i,this.rowsPerGrid=o,this.filter=n,!this.gridId)throw Error("Grid ID is required");if(!r)throw Error("Rows are required");for(this.rows=[],d=0,l=r.length;l>d;d++)s=r[d],this.rows.push({id:s.id,columns:s.columns,selected:s.selected,updatedColumns:s.updatedColumns})}return t.prototype.page=function(){return this.page},t.prototype.total=function(){return this.total},t.prototype.filter=function(){return this.filter},t.prototype.serialize=function(){return{gridId:this.gridId,rows:this.rows,page:this.page,total:this.total,rowsPerGrid:this.rowsPerGrid,filter:this.filter}},t}(),GridChangeService=function(){function t(){}return t.prototype.change=function(t,r,e,i){if(!t)throw Error("Grid ID is required");if(!r)throw Error("Page is required");if(!e)throw Error("Rows Per Grid is required");return DomainRegistry.gridRepository().gridOfId(t,function(t,o){var n;if(t)throw Error(t);if(null!==o)return n={gridId:o.id,page:r,rowsPerGrid:e,filter:i},DomainRegistry.rowRepository().rowsSpecifiedBy(n,function(t,r){if(t)throw Error(t);return void 0!==n.filter&&(i=JSON.parse(n.filter)),o.change(r.rows,n.page,r.total,n.rowsPerGrid,i)})}),null},t}(),GridRepository=function(){function t(t){var r,e,i;for(null==t&&(t=[]),this.grids={},e=0,i=t.length;i>e;e++)r=t[e],this.add(r)}return t.prototype.gridOfId=function(t,r){return this.grids[t]?r(null,this.grids[t]):(r(null,null),void 0)},t.prototype.add=function(t){return this.grids[t.id]=t},t}(),Row=function(){function t(t,r,e){var i,o,n=this;this.id=t,this.gridId=null!=e?e:null,this.columns={};for(i in r)__hasProp.call(r,i)&&(o=r[i],null===o&&(o=""),this.columns[i]=""+o);this.modified=!1,this.deleted=!1,this.selected=!1,this.updatedColumns=[],DomainEvent.subscribe("AllRowsSelected",function(t){return t.gridId===n.gridId?n.select():void 0}),DomainEvent.subscribe("AllRowsUnselected",function(t){return t.gridId===n.gridId?n.unselect():void 0})}return t.prototype.updateColumn=function(t,r){if(t in this.columns){if(this.columns[t]===r)return null;this.modified=!0,this.columns[t]=r,this.updatedColumns.push(t),DomainEvent.publish("ColumnUpdated",new ColumnUpdated(this.gridId,this.id,t,r))}return null},t.prototype.isModified=function(){return this.modified},t.prototype.save=function(){return this.modified===!0?(this.modified=!1,DomainEvent.publish("RowSaved",new RowSaved(this.gridId,this.id))):void 0},t.prototype.remove=function(){return this.deleted=!0,DomainEvent.publish("RowRemoved",new RowRemoved(this.gridId,this.id)),null},t.prototype.select=function(){return this.selected===!1&&(this.selected=!0,DomainEvent.publish("RowSelected",new RowSelected(this.gridId,this.id))),null},t.prototype.unselect=function(){return this.selected===!0&&(this.selected=!1,DomainEvent.publish("RowUnselected",new RowUnselected(this.gridId,this.id))),null},t}(),ColumnUpdated=function(){function t(t,r,e,i){if(this.gridId=t,this.rowId=r,this.columnId=e,this.columnValue=i,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is reuqired");if(!this.columnId)throw Error("Column ID is required");if(null==this.columnValue)throw Error("Column Value is required")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId,columnId:this.columnId,columnValue:this.columnValue}},t}(),RowRemoved=function(){function t(t,r){if(this.gridId=t,this.rowId=r,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},t}(),RowSaved=function(){function t(t,r){if(this.gridId=t,this.rowId=r,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},t}(),RowSelected=function(){function t(t,r){if(this.gridId=t,this.rowId=r,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},t}(),RowUnselected=function(){function t(t,r){if(this.gridId=t,this.rowId=r,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},t}(),RowRepository=function(){function t(){}return t.prototype.add=function(){},t.prototype.rowOfId=function(){},t}(),JQueryAjaxRowRepository=function(t){function r(t,r){this.ajaxQueryURL=t,this.ajaxCommandURL=r,this.gridContainer=new InMemoryRowContainer}return __extends(r,t),r.prototype.add=function(t){if(!t.id)throw Error("Row ID is not specified");if(!t.gridId)throw Error("Grid ID is not specified");return this.gridContainer.add(t)},r.prototype.rowOfId=function(t,r,e){var i;return t||e("Missing argument: gridId",null),r||e("Missing argument: rowId",null),i=this.gridContainer.get(t,r),i instanceof Row?e(null,i):e(null,null)},r.prototype.save=function(t,r,e){var i,o;return t||e("Missing argument: gridId",null),r||e("Missing argument: rowId",null),o=this.gridContainer.get(t,r),o.isModified()?(i={},i.bulk=!1,i.gridId=t,i.rowId=r,i.columns=JSON.stringify(o.columns),i.deleted=o.deleted,$.ajax({url:this.ajaxCommandURL,data:i,dataType:"json",success:function(){return o.save()}})):void 0},r.prototype.saveAll=function(t,r){var e,i;return t||r("Missing argument: gridId",null),i=this.gridContainer.getModifiedRows(t),0!==Object.keys(i).length?(e={},e.bulk=!0,e.gridId=t,e.rows=JSON.stringify(i),$.ajax({url:this.ajaxCommandURL,data:e,dataType:"json",success:function(){var t,r,e;e=[];for(r in i)t=i[r],e.push(t.save());return e}})):void 0},r.prototype.rowsSpecifiedBy=function(t,r){var e=this;return $.ajax({url:this.ajaxQueryURL,data:{id:t.gridId,page:t.page,rowsPerGrid:t.rowsPerGrid,filter:t.filter},dataType:"json",success:function(t){var i,o,n,s,d,l,u,a,c,h,p,f;if("object"!=typeof t)return r("Response is not object",null);if(!("id"in t))return r("Invalid scheme: gridId is missing",null);if(!("rows"in t))return r("Invalid scheme: rows is missing",null);if(!("total"in t))return r("Invalid scheme: total is missing",null);for(p=t.rows,u=0,c=p.length;c>u;u++)if(n=p[u],!n.id)return r("Row id is missing: "+JSON.stringify(n),null);for(i=t.id,d=t.rows,l=[],f=t.rows,a=0,h=f.length;h>a;a++)s=f[a],e.gridContainer.addByData(i,s),n=e.gridContainer.get(i,s.id),l.push(n);return o={gridId:i,rows:l,total:t.total},r(null,o),null},error:function(t,e,i){return r(i,null)}})},r}(RowRepository),InMemoryRowContainer=function(){function t(){this.grids={}}return t.prototype.addByData=function(t,r){var e,i,o=this;if(!t)throw Error("Grid ID is required");if(!(r instanceof Object))throw Error("Row data must be instance of Object");if(r instanceof Row)throw Error("Row data must NOT be instance of Row");if(!r.id)throw Error('Row must contain "id" key');return i=r.id,this._rowExists(t,i)?void 0:(e=this._removeIdFromColumns(r,"id"),DomainRegistry.gridRepository().gridOfId(t,function(r,n){var s;if(r)throw Error("Failed to find Grid");if(!(n instanceof Grid))throw Error("Grid not found");return s=new Row(i,e,t),s.selected=n.allRowSelected()?!0:!1,o.add(s)}),null)},t.prototype.add=function(t){var r,e;if(!(t instanceof Row))throw Error("Row must be instanceof Row");if(!t.id)throw Error("Row ID is required");if(!t.gridId)throw Error("Row grid ID is required");return r=t.gridId,e=t.id,void 0===this.grids[r]&&(this.grids[r]={}),this.grids[r][e]=t,null},t.prototype.get=function(t,r){if(!t)throw Error("Grid ID is required");if(!r)throw Error("Row ID is required");return this._rowExists(t,r)?this.grids[t][r]:null},t.prototype.getModifiedRows=function(t){var r,e,i,o;if(!t)throw Error("Grid ID is required");if(!this._gridExists(t))throw Error("Grid not found: "+t);r={},o=this.grids[t];for(i in o)e=o[i],e.isModified()&&(r[i]=e);return r},t.prototype._gridExists=function(t){return null!=this.grids[t]},t.prototype._rowExists=function(t,r){var e;return null!=(null!=(e=this.grids[t])?e[r]:void 0)},t.prototype._removeIdFromColumns=function(t,r){var e,i,o;e={};for(i in t)__hasProp.call(t,i)&&(o=t[i],i===r||(e[i]=o));return e},t}(),GridService=function(){function t(){}return t.prototype.startup=function(t,r,e,i){var o,n,s,d,l,u;if(!t)throw Error("Grid ID is required");if(!r)throw Error("Columns Config are required");if(!e)throw Error("Ajax Query URL is required");for(i||(i=e),r=JSON.parse(r),o=[],l=0,u=r.length;u>l;l++)n=r[l],s=[],o.push(new Column(n.id,n.title,s));return d=new Grid(t,o),DomainRegistry.gridRepository().add(d),DomainRegistry.setRowRepository(new JQueryAjaxRowRepository(e,i)),null},t.prototype.select=function(t,r){return DomainRegistry.rowRepository().rowOfId(t,r,function(t,r){if(t)throw Error(t);return null===r?null:r.select()}),null},t.prototype.save=function(t,r){var e;return e=DomainRegistry.rowRepository(),e.save(t,r,function(t,r){if(t)throw Error(t);return null===r?null:void 0}),null},t.prototype.saveAll=function(t){var r;return r=DomainRegistry.rowRepository(),r.saveAll(t)},t.prototype.unselect=function(t,r){return DomainRegistry.rowRepository().rowOfId(t,r,function(t,r){if(t)throw Error(t);return null===r?null:r.unselect()}),null},t.prototype.selectAll=function(t){return DomainRegistry.gridRepository().gridOfId(t,function(t,r){if(t)throw Error(t);return null===r?null:r.selectAllRows()}),null},t.prototype.unselectAll=function(t){return DomainRegistry.gridRepository().gridOfId(t,function(t,r){if(t)throw Error(t);return null===r?null:r.unselectAllRows()}),null},t.prototype.append=function(t,r,e){return DomainRegistry.gridRepository().gridOfId(t,function(t,i){if(t)throw Error(t);return null===i?null:i.append(new Row(r,e))}),null},t.prototype.updateColumn=function(t,r,e,i){return DomainRegistry.gridRepository().gridOfId(t,function(t,o){if(t)throw Error(t);return null===o?null:o.updateColumn(r,e,i)}),null},t.prototype.removeRow=function(t,r){return DomainRegistry.gridRepository().gridOfId(t,function(t,e){if(t)throw Error(t);return null===e?null:e.removeRow(r)}),null},t.prototype.change=function(t,r,e,i){if(!t)throw Error("Grid ID is required");if(!r)throw Error("Page is required");if(!e)throw Error("Rows Per Grid is required");return DomainRegistry.gridChangeService().change(t,r,e,i),null},t}(),Table=function(){function t(t,r,e,i,o){var n=this;this.tableId=t,this.table=r,this.moveMode=e,this.gridService=i,this.rows={},this.rowsById={},this.numberOfRows=0,this.columnConfig=JSON.parse(o),this.currentCursor=void 0,$(document).on("keydown",function(t){var r,e,i;if(r=n.findRow(n.currentCursor),0!==r.length)if(32===t.which&&(t.preventDefault(),i=r.attr("data-id").split(".")[2],r.hasClass("row_selected")?n.gridService.unselect(n.tableId,i):n.gridService.select(n.tableId,i)),40===t.which){if(t.preventDefault(),e=r.next(),0!==e.length)return n.cursorRow(e.attr("data-id"))}else if(38===t.which&&(t.preventDefault(),e=r.prev(),0!==e.length))return n.cursorRow(e.attr("data-id"))})}return t.prototype.reset=function(){return this.rows={},this.rowsById={},this.numberOfRows=0,this.currentCursor=void 0},t.prototype.selector=function(){return this.table.selector},t.prototype.header=function(t){var r,e,i,o,n,s,d,l,u;for(this.columns=t,e=$("<tr></tr>"),"function"==typeof(n=this.moveMode).beforeHeader&&n.beforeHeader(e),u=this.columns,d=0,l=u.length;l>d;d++)r=u[d],o=$("<th></th>").attr("data-column-id",r.id),o.on("click",function(){var t,r;return t=$(this).attr("data-column-id"),r=$(this).find("i"),r.hasClass("icon-caret-down")?(r.removeClass(),$(this).parents("tr").find("i").each(function(t,r){return $(r).removeClass()}),r.addClass("icon-caret-up"),ViewEvent.publish("ViewSortChanged",new ViewSortChanged(t,"asc"))):(r.removeClass(),$(this).parents("tr").find("i").each(function(t,r){return $(r).removeClass()}),r.addClass("icon-caret-down"),ViewEvent.publish("ViewSortChanged",new ViewSortChanged(t,"desc")))}),i=$("<span></span>"),i.append(r.title),i.append($("<i></i>")),e.append(o.append(i)),this.table.find("thead").append(e);return"function"==typeof(s=this.moveMode).afterHeader?s.afterHeader(e):void 0},t.prototype.get=function(t){return this.rows[t]},t.prototype.getById=function(t){return this.rowsById[t]},t.prototype.removeById=function(t){var r;return this.findRow(t).remove,r=this.getById(t),delete this.rowsById[t],r},t.prototype.updateById=function(t,r){var e,i,o,n,s,d,l;for(i=this.rowIdOfGlobal(t),o=$("<tr></tr>").attr("data-id",i),n=$(this.table).find('tr[data-id="'+i+'"]'),this.getById(i=r),e=0,d=0,l=r.length;l>d;d++)s=r[d],o.append(this.createRowColumn(this.columns[e],s)),e++;return n.html(o.html())},t.prototype.cursorTop=function(){var t;return t=this.get(0),this.cursorRow(this.rowIdOfGlobal(t.id))},t.prototype.cursorRow=function(t){return void 0===this.currentCursor?this.addClassToRow(t,"current"):(this.removeClassFromRow(this.currentCursor,"current"),this.addClassToRow(t,"current")),this.currentCursor=t},t.prototype.rowIdOfGlobal=function(t){return this.tableId+"."+t},t.prototype.insert=function(t,r){var e,i,o,n,s,d,l,u;for(void 0===r&&(r=this.guid()),i=this.rowIdOfGlobal(r),o=$("<tr></tr>").attr("data-id",i),"function"==typeof(n=this.moveMode).beforeInsert&&n.beforeInsert(r,o),this.rows[this.numberOfRows++]={id:r,data:t},this.rowsById[r]=t,u=this.columnConfig,d=0,l=u.length;l>d;d++)e=u[d],o.append(this.createRowColumn(e,t[e.id]));return this.table.find("tbody").append(o),"function"==typeof(s=this.moveMode).afterInsert?s.afterInsert(r,o):void 0},t.prototype.filterRowExists=function(){return 0!==this.table.find("tbody tr.filter").length},t.prototype.setFilterRow=function(t){var r,e,i,o,n,s;for(void 0===t&&(t={}),e=$("<tr></tr>").addClass("filter"),"function"==typeof(i=this.moveMode).beforeInsert&&i.beforeInsert(void 0,e),s=this.columnConfig,o=0,n=s.length;n>o;o++)r=s[o],e.append(this.createFilterColumn(r,t[r.id]));return this.table.find("tbody").append(e)},t.prototype.createRowColumn=function(t,r){var e;return e=$("<td></td>"),e.addClass(t).attr("data-column",t.id),e.attr("data-column-editable",t.editable),t.editable===!1&&e.addClass("disabled"),e.append($("<span></span>").append(r))},t.prototype.createFilterColumn=function(t,r){var e,i,o=this;return i=$("<td></td>"),e=$("<input></input>").attr("type","text").attr("data-filter-column",t.id).val(r).addClass("filter_input"),e.on("keyup",function(){return window.clearTimeout(o.timeoutID),o.timeoutID=setTimeout(function(){var t;return t=[],$(".filter_input").each(function(e,i){var o;return o=$(i).attr("data-filter-column"),r=$(i).val(),t.push({columnId:o,value:r})}),ViewEvent.publish("ViewFilterChanged",new ViewFilterChanged(t))},450)}),i.append(e)},t.prototype.selectRow=function(t,r){var e,i;return"function"==typeof(e=this.moveMode).beforeRowSelect&&e.beforeRowSelect(t),this.addClassToRow(this.rowIdOfGlobal(t),r),"function"==typeof(i=this.moveMode).afterRowSelect?i.afterRowSelect(t):void 0},t.prototype.unselectRow=function(t,r){var e,i;return"function"==typeof(e=this.moveMode).beforeRowUnselect&&e.beforeRowUnselect(t),this.removeClassFromRow(this.rowIdOfGlobal(t),r),"function"==typeof(i=this.moveMode).afterRowUnselect?i.afterRowUnselect(t):void 0},t.prototype.addClassToRow=function(t,r){var e;return e=$(this.findRow(t)),e.hasClass(r)?void 0:e.addClass(r)},t.prototype.addClassToColumn=function(t,r,e){var i,o;return o=this.findRow(t),i=o.find('td[data-column="'+r+'"]'),i.addClass(e)},t.prototype.removeClassFromRow=function(t,r){return this.findRow(t).removeClass(r)},t.prototype.removeAllRows=function(){return this.reset(),this.table.find("tbody").html("")},t.prototype.removeAllRowsWithout=function(t){return this.reset(),this.table.find("tbody tr").each(function(r,e){return $(e).hasClass(t)?void 0:$(e).remove()})},t.prototype.removeAllClassesFromRow=function(t){var r;return r=this.findRow(t),r.removeClass()},t.prototype.toggleClassToRow=function(t,r){return this.findRow(t).toggleClass(r)},t.prototype.hasClassOfRow=function(t,r){return this.findRow(t).hasClass(r)},t.prototype.findRow=function(t){return $(this.table).find('tr[data-id="'+t+'"]')},t.prototype.listen=function(t,r,e){return this.findRow(t).on(r,function(){return e(t,$(this))})},t.prototype.listenRowEvent=function(t,r){return this.table.on(t,"tr",function(){var t;return t=$(this).attr("data-id"),r(t,$(this))})},t.prototype.toRowEdit=function(t){var r;return r=this.findRow(t)},t.prototype.toCellEdit=function(t,r){var e,i;return i=this.findRow(t),e=i.find('td[data-column="'+r+'"]'),this.isCellEditable(e)?this._editCell(e):void 0},t.prototype.isCellEditable=function(t){return"true"===t.attr("data-column-editable")},t.prototype._editPreviousCell=function(t){return t=this.searchEditableColumnToBackward(t),t===!1?!1:this.isCellEditable(t)?this._editCell(t):void 0},t.prototype.searchEditableColumnToBackward=function(t,r){var e,i,o;return null==r&&(r=1),r>20?!1:(o=t.prev(),this.isCellEditable(o)?o:0===o.length&&(i=t.parent().prev(),e=i.children().length,o=$(i.children()[e-1]),this.isCellEditable(o))?o:this.searchEditableColumnToBackward(o,r+1))},t.prototype.searchEditableColumnToForward=function(t,r){var e,i;return null==r&&(r=1),r>20?!1:(e=t.next(),this.isCellEditable(e)?e:0===e.length&&(i=t.parent().next(),e=$(i.children()[0]),this.isCellEditable(e))?e:this.searchEditableColumnToForward(e,r+1))},t.prototype._editNextCell=function(t){return t=this.searchEditableColumnToForward(t),t===!1?!1:this.isCellEditable(t)?this._editCell(t):void 0},t.prototype._editCell=function(t){var r,e;return t===!1?!1:(r=$('<input type="text"></input>').addClass("inline_edit").val(t.text()),TableUIHelper.fitInputToCell(r,t),t.find("span").replaceWith(r),r.select(),"function"==typeof(e=this.moveMode).move?e.move(r,t):void 0)},t.prototype.listenCellEvent=function(t,r){return this.table.on(t,"td",function(){var t;return t=$(this).parents("tr").attr("data-id"),r(t,$(this))})},t.prototype.listenTextEvent=function(t,r){return this.table.find("span").on(t,function(){var t;return t=$(this).parents("tr").attr("data-id"),r(t,$(this)),!1})},t.prototype.s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},t.prototype.guid=function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},t}(),ViewFilterChanged=function(){function t(t){this.filterConditions=t}return t.prototype.serialize=function(){var t,r,e,i,o;for(r={},o=this.filterConditions,e=0,i=o.length;i>e;e++)t=o[e],r[t.columnId]=t.value;return r},t}(),ViewSortChanged=function(){function t(t,r){this.columnId=t,this.direction=r}return t.prototype.serialize=function(){return{columnId:this.columnId,direction:this.direction}},t}(),TableUIHelper=function(){function t(){}return t.fitInputToCell=function(t,r){var e,i,o,n,s,d,l,u,a;return l=parseInt(r.css("paddingLeft"),10),u=parseInt(r.css("paddingRight"),10),a=parseInt(r.css("paddingTop"),10),d=parseInt(r.css("paddingBottom"),10),o=parseInt(r.css("borderLeft"),10),n=parseInt(r.css("borderRight"),10),s=parseInt(r.css("borderTop"),10),i=parseInt(r.css("borderBottom"),10),e=2,t.css("marginLeft",-1*l),t.css("marginRight",-1*u),t.css("marginTop",-1*(a+s+e)),t.css("marginBottom",-1*d),t.width(r.width()+l+u),t.height(r.height()+a+d+s)},t}(),ExcelMoveMode=function(){function t(){}return t.prototype.init=function(t,r,e){var i=this;return this.table=t,this.applicationGridService=r,this.rowSelectedClass=e,this.table.listenCellEvent("click",function(t,r){var e;return e=r.attr("data-column"),i.table.toCellEdit(t,e)})},t.prototype.beforeHeader=function(t){var r,e=this;return r=$("<input></input>").attr("type","checkbox"),r.on("click",function(){var t;return t=$(e),t.prop("checked")?(e.applicationGridService.unselectAll(e.table.tableId),t.prop("checked",!1)):(e.applicationGridService.selectAll(e.table.tableId),t.prop("checked",!0))}),t.append($("<th></th>").append(r))},t.prototype.beforeInsert=function(t,r){var e,i=this;return void 0===t?(r.append($("<td></td>")),void 0):(e=$("<input></input>").attr("type","checkbox"),e.attr("data-row-id",t),e.on("click",function(){return i.table.hasClassOfRow(i.table.rowIdOfGlobal(t),i.rowSelectedClass)?i.applicationGridService.unselect(i.table.tableId,t):i.applicationGridService.select(i.table.tableId,t)}),r.append($("<td></td>").append(e)))},t.prototype.beforeRowSelect=function(t){return $('input[data-row-id="'+t+'"]').prop("checked",!0)},t.prototype.beforeRowUnselect=function(t){return $('input[data-row-id="'+t+'"]').prop("checked",!1)},t.prototype.move=function(t,r){var e,i,o,n=this;return o=this.table.tableId,i=r.parents().attr("data-id").split(".")[2],e=r.attr("data-column"),t.on("keydown",function(s){var d,l,u,a,c;return 9===s.which&&(s.preventDefault(),c=t.val(),n.applicationGridService.updateColumn(o,i,e,c),t.replaceWith($("<span></span>").text(c)),s.shiftKey===!0?n.table._editPreviousCell(r):n.table._editNextCell(r)),13===s.which?(t.replaceWith($("<span></span>").text(t.val())),c=t.val(),n.applicationGridService.updateColumn(o,i,e,c),s.shiftKey===!0?(a=$(r.parent().prev()),u=a.find('td[data-column="'+r.attr("data-column")+'"]'),n.table._editCell(u)):(l=$(r.parent().next()),d=l.find('td[data-column="'+r.attr("data-column")+'"]'),n.table._editCell(d))):void 0}),t.on("blur",function(){var r;return r=t.val(),n.applicationGridService.updateColumn(o,i,e,r),t.replaceWith($("<span></span>").text(t.val()))})},t}(),MoveModeFactory=function(){function t(){}return t.classes={excel:ExcelMoveMode,sequence:SequenceMoveMode},t.create=function(t){return new this.classes[t]},t}(),SequenceMoveMode=function(){function t(){}return t.prototype.move=function(t,r,e){return t.on("keypress",function(i){return 13===i.which?(t.replaceWith($("<span></span>").text(t.val())),0===r.next().length?e._editCell($(r.parent().next().find("td")[0])):e._editCell(r.next())):void 0}),t.on("blur",function(){return t.replaceWith($("<span></span>").text(t.val()))})},t}(),ViewController=function(){function t(t,r,e,i,o,n){this.gridId=t,this.columnConfigJSON=r,this.tableSelector=i,this.rowSelectedClass=null!=o?o:"row_selected",this.moveModeName=n,this.rowModifiedClass="row_modified",this.applicationGridService=new GridService,this.applicationGridService.startup(this.gridId,r,e)}return t.prototype.startup=function(t,r){var e,i=this;return this.page=t,this.rowsPerGrid=r,e=MoveModeFactory.create(this.moveModeName),this.table=new Table(this.gridId,$(this.tableSelector),e,this.applicationGridService,this.columnConfigJSON),this.table.header(JSON.parse(this.columnConfigJSON)),e.init(this.table,this.applicationGridService,this.rowSelectedClass),this.applicationGridService.change(this.gridId,t,r),this.table.filterRowExists()||this.table.setFilterRow(),DomainEvent.subscribe("GridChanged",function(t){var r,e,o,n,s,d,l,u;if(t.gridId!==i.gridId)return null;for(i.table.removeAllRowsWithout("filter"),l=t.rows,o=0,s=l.length;s>o;o++){for(e=l[o],i.table.insert(e.columns,e.id),e.selected===!0&&i.table.selectRow(e.id,i.rowSelectedClass),u=e.updatedColumns,n=0,d=u.length;d>n;n++)r=u[n],i.table.addClassToColumn(i.table.rowIdOfGlobal(e.id),r,"column_modified");t.rows.length>0&&i.cursor()}return null}),DomainEvent.subscribe("ColumnUpdated",function(t){return i.table.addClassToColumn(i.table.rowIdOfGlobal(t.rowId),t.columnId,"column_modified")}),DomainEvent.subscribe("RowAppended",function(t){return t.gridId===i.gridId?i.table.insert(t.columns,t.rowId):void 0}),DomainEvent.subscribe("RowSelected",function(t){return t.gridId===i.gridId?i.table.selectRow(t.rowId,i.rowSelectedClass):void 0}),DomainEvent.subscribe("RowUnselected",function(t){return t.gridId===i.gridId?i.table.unselectRow(t.rowId,i.rowSelectedClass):void 0}),ViewEvent.subscribe("ViewFilterChanged",function(t){return i.applicationGridService.change(i.gridId,i.page,i.rowsPerGrid,JSON.stringify(t))})},t.prototype.add=function(t,r){return this.applicationGridService.append(this.gridId,t,r)},t.prototype.save=function(t){return this.applicationGridService.save(this.gridId,t)},t.prototype.saveAll=function(){return this.applicationGridService.saveAll(this.gridId)},t.prototype.selectAll=function(){return this.applicationGridService.selectAll(this.gridId)},t.prototype.unselectAll=function(){return this.applicationGridService.unselectAll(this.gridId)},t.prototype.movePageTo=function(t){return this.page=t,this.applicationGridService.change(this.gridId,this.page,this.rowsPerGrid)},t.prototype.cursor=function(t){return void 0!==t&&this.table.cursorRow(t),this.table.cursorTop()},t}(),ViewEvent={channels:{"*":[]},publish:function(t,r){var e,i,o,n,s,d,l,u;t in this.channels||(this.channels[t]=[]),e=r.serialize(),l=this.channels["*"];for(o=0,s=l.length;s>o;o++)i=l[o],i(e,t);for(u=this.channels[t],n=0,d=u.length;d>n;n++)i=u[n],i(e,t);return null},subscribe:function(t,r){return t in this.channels||(this.channels[t]=[]),this.channels[t].push(r),null}};