/*! chair 2013-05-02 */
var AjaxDataSource,AllRowsSelected,AllRowsUnselected,ArrayDataSource,Column,ColumnFormat,ColumnUpdated,DomainEvent,DomainRegistry,ExcelMoveMode,Grid,GridChangeService,GridChanged,GridRepository,GridService,JQueryAjaxRowRepository,MoveModeFactory,Row,RowAppended,RowRemoved,RowRepository,RowSelected,RowUnselected,SequenceMoveMode,Table,TableUIHelper,ViewController,__hasProp={}.hasOwnProperty,__extends=function(t,e){function r(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Column=function(){function t(t,e,r){null==r&&(r=[]),this.id=t,this.name=e,this.formats=r}return t.prototype.format=function(t){var e,r,i,o;for(t=this.escapeHTML(t),o=this.formats,r=0,i=o.length;i>r;r++)e=o[r],t=e.format(t);return t},t.prototype.escapeHTML=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},t}(),ColumnFormat=function(){function t(t){this.formatter=t}return t.prototype.format=function(t){return this.formatter(t)},t}(),DomainEvent={channels:{"*":[]},publish:function(t,e){var r,i,o,n,s,d,l,u;t in this.channels||(this.channels[t]=[]),r=e.serialize(),l=this.channels["*"];for(o=0,s=l.length;s>o;o++)i=l[o],i(r,t);for(u=this.channels[t],n=0,d=u.length;d>n;n++)i=u[n],i(r,t);return null},subscribe:function(t,e){return t in this.channels||(this.channels[t]=[]),this.channels[t].push(e),null}},DomainRegistry={_gridRepository:null,_rowRepository:null,gridRepository:function(){return null===this._gridRepository&&(this._gridRepository=new GridRepository),this._gridRepository},rowRepository:function(){if(!this._rowRepository)throw Error("Row Repository has not been initialized");return this._rowRepository},setRowRepository:function(t){this._rowRepository=t},gridChangeService:function(){return new GridChangeService}},Grid=function(){function t(t,e){var i,o,n;if(this.id=t,!this.id)throw Error("Grid ID is required");for(this._rows={},this.columns=[],o=0,n=e.length;n>o;o++)i=e[o],this.columns.push(i);this.selectionStatus=r}var e,r;return r=0,e=1,t.prototype.selectAllRows=function(){return this.selectionStatus=e,DomainEvent.publish("AllRowsSelected",new AllRowsSelected(this.id)),null},t.prototype.unselectAllRows=function(){return this.selectionStatus=r,DomainEvent.publish("AllRowsUnselected",new AllRowsUnselected(this.id)),null},t.prototype.append=function(t){if(this._hasRow(t.id))throw Error("Row(id:"+t.id+") already exists in the Grid(id:"+this.id+")");return this._addRow(t),DomainEvent.publish("RowAppended",new RowAppended(this.id,t.id,t.columns))},t.prototype.updateColumn=function(t,e,r){return this._hasRow(t)?this._getRow(t).updateColumn(e,r,this.id):void 0},t.prototype.rows=function(){var t,e;return function(){var r,i;r=this._rows,i=[];for(t in r)__hasProp.call(r,t)&&(e=r[t],i.push(e));return i}.call(this)},t.prototype.change=function(t){var e,r,i;for(this._rows={},r=0,i=t.length;i>r;r++)e=t[r],this._addRow(e);return DomainEvent.publish("GridChanged",new GridChanged(this.id,t))},t.prototype.removeRow=function(t){return this._hasRow(t)?(this._getRow(t).remove(),delete this._rows[t]):void 0},t.prototype._hasRow=function(t){return this._rows[t]?!0:!1},t.prototype._getRow=function(t){return this._rows[t]},t.prototype._addRow=function(t){return this._rows[t.id]=t,t.gridId=this.id},t}(),RowAppended=function(){function t(t,e,r){var i,o;if(this.gridId=t,this.rowId=e,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is required");if(!r)throw Error("Column Values are required");this.columns=[];for(i in r)o=r[i],this.columns.push(o)}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId,columns:this.columns}},t}(),AllRowsSelected=function(){function t(t){if(this.gridId=t,!this.gridId)throw Error("Grid ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId}},t}(),AllRowsUnselected=function(){function t(t){if(this.gridId=t,!this.gridId)throw Error("Grid ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId}},t}(),GridChanged=function(){function t(t,e){var r,i,o;if(this.gridId=t,!this.gridId)throw Error("Grid ID is required");if(!e)throw Error("Rows are required");for(this.rows=[],i=0,o=e.length;o>i;i++)r=e[i],this.rows.push({id:r.id,columns:r.columns,selected:r.selected})}return t.prototype.serialize=function(){return{gridId:this.gridId,rows:this.rows}},t}(),GridChangeService=function(){function t(){}return t.prototype.change=function(t,e,r){if(!t)throw Error("Grid ID is required");if(!e)throw Error("Page is required");if(!r)throw Error("Rows Per Grid is required");return DomainRegistry.gridRepository().gridOfId(t,function(t,i){var o;if(t)throw Error(t);if(null!==i)return o={gridId:i.id,page:e,rowsPerGrid:r},DomainRegistry.rowRepository().rowsSpecifiedBy(o,function(t,e){if(t)throw Error(t);return i.change(e)})}),null},t}(),GridRepository=function(){function t(t){var e,r,i;for(null==t&&(t=[]),this.grids={},r=0,i=t.length;i>r;r++)e=t[r],this.add(e)}return t.prototype.gridOfId=function(t,e){return this.grids[t]?e(null,this.grids[t]):(e(null,null),void 0)},t.prototype.add=function(t){return this.grids[t.id]=t},t}(),Row=function(){function t(t,e){var r,i,o=this;this.id=t,this.columns={};for(r in e)__hasProp.call(e,r)&&(i=e[r],this.columns[r]=""+i);this.deleted=!1,this.gridId=null,this.selected=!1,DomainEvent.subscribe("AllRowsSelected",function(t){return t.gridId===o.gridId?o.select():void 0}),DomainEvent.subscribe("AllRowsUnselected",function(t){return t.gridId===o.gridId?o.unselect():void 0})}return t.prototype.updateColumn=function(t,e){return this.columns[t]&&(this.columns[t]=e,DomainEvent.publish("ColumnUpdated",new ColumnUpdated(this.gridId,this.id,t,e))),null},t.prototype.remove=function(){return this.deleted=!0,DomainEvent.publish("RowRemoved",new RowRemoved(this.gridId,this.id)),null},t.prototype.select=function(){return this.selected===!1&&(this.selected=!0,DomainEvent.publish("RowSelected",new RowSelected(this.gridId,this.id))),null},t.prototype.unselect=function(){return this.selected===!0&&(this.selected=!1,DomainEvent.publish("RowUnselected",new RowUnselected(this.gridId,this.id))),null},t}(),ColumnUpdated=function(){function t(t,e,r,i){if(this.gridId=t,this.rowId=e,this.columnId=r,this.columnValue=i,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is reuqired");if(!this.columnId)throw Error("Column ID is required");if(!this.columnValue)throw Error("Column Value is required")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId,columnId:this.columnId,columnValue:this.columnValue}},t}(),RowRemoved=function(){function t(t,e){if(this.gridId=t,this.rowId=e,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},t}(),RowSelected=function(){function t(t,e){if(this.gridId=t,this.rowId=e,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},t}(),RowUnselected=function(){function t(t,e){if(this.gridId=t,this.rowId=e,!this.gridId)throw Error("Grid ID is required");if(!this.rowId)throw Error("Row ID is required")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},t}(),RowRepository=function(){function t(){}return t.prototype.add=function(){},t.prototype.rowOfId=function(){},t}(),JQueryAjaxRowRepository=function(t){function e(t){this.ajaxURL=t,this._grids={}}return __extends(e,t),e.prototype.add=function(t){var e,r;if(!t.id)throw Error("Row ID is not specified");if(!t.gridId)throw Error("Grid ID is not specified");return e=t.gridId,r=t.id,e in this._grids||(this._grids[e]={}),this._grids[e][r]=t},e.prototype.rowOfId=function(t,e,r){var i;if(!t)throw Error("Missing argument: gridId");if(!e)throw Error("Missing argument: rowId");return null!=(null!=(i=this._grids[t])?i[e]:void 0)?r(null,this._grids[t][e]):r(null,null)},e.prototype.rowsSpecifiedBy=function(t,e){var r=this;return $.ajax({url:this.ajaxURL,data:{id:t.gridId},dataType:"json",success:function(t){var i,o,n,s,d,l,u,a,c,h,p,f,w,g,y;if("object"!=typeof t)return e("Response is not object",null);if(!("id"in t))return e("Invalid scheme: gridId is missing",null);if(!("rows"in t))return e("Invalid scheme: rows is missing",null);if(!("total"in t))return e("Invalid scheme: total is missing",null);for(w=t.rows,c=0,p=w.length;p>c;c++)if(s=w[c],!s.id)return e("Row id is missing: "+JSON.stringify(s),null);for(o=t.id,d=t.rows,u=t.total,l=[],g=t.rows,h=0,f=g.length;f>h;h++)if(s=g[h],null!=(null!=(y=r._grids[o])?y[s.id]:void 0))l.push(r._grids[o][s.id]);else{i={};for(n in s)__hasProp.call(s,n)&&(a=s[n],"id"!==n&&(i[n]=a));l.push(new Row(s.id,i))}return e(null,l),null},error:function(t,r,i){return e(i,null)}})},e}(RowRepository),GridService=function(){function t(){}return t.prototype.startup=function(t,e,r){var i,o,n,s,d,l;if(!t)throw Error("Grid ID is required");if(!e)throw Error("Columns Config are required");if(!r)throw Error("Ajax URL is required");for(e=JSON.parse(e),i=[],d=0,l=e.length;l>d;d++)o=e[d],n=[],i.push(new Column(o.id,o.title,n));return s=new Grid(t,i),DomainRegistry.gridRepository().add(s),DomainRegistry.setRowRepository(new JQueryAjaxRowRepository(r)),null},t.prototype.select=function(t,e){return DomainRegistry.rowRepository().rowOfId(t,e,function(t,e){if(t)throw Error(t);return null===e?null:e.select()}),null},t.prototype.unselect=function(t,e){return DomainRegistry.rowRepository().rowOfId(t,e,function(t,e){if(t)throw Error(t);return null===e?null:e.unselect()}),null},t.prototype.selectAll=function(t){return DomainRegistry.gridRepository().gridOfId(t,function(t,e){if(t)throw Error(t);return null===e?null:e.selectAllRows()}),null},t.prototype.unselectAll=function(t){return DomainRegistry.gridRepository().gridOfId(t,function(t,e){if(t)throw Error(t);return null===e?null:e.unselectAllRows()}),null},t.prototype.updateColumn=function(t,e,r,i){return DomainRegistry.gridRepository().gridOfId(t,function(t,o){if(t)throw Error(t);return null===o?null:o.updateColumn(e,r,i)}),null},t.prototype.removeRow=function(t,e){return DomainRegistry.gridRepository().gridOfId(t,function(t,r){if(t)throw Error(t);return null===r?null:r.removeRow(e)}),null},t.prototype.change=function(t,e,r){if(!t)throw Error("Grid ID is required");if(!e)throw Error("Page is required");if(!r)throw Error("Rows Per Grid is required");return DomainRegistry.gridChangeService().change(t,e,r),null},t}(),Table=function(){function t(t,e,r){var i=this;this.table=t,this.moveMode=e,this.gridService=r,this.rows={},this.rowsById={},this.numberOfRows=0,this.currentCursor=void 0,$(document).on("keydown",function(t){var e,r;if(e=i.findRow(i.currentCursor),0!==e.length)if(32===t.which&&(t.preventDefault(),e.hasClass("row_selected")?i.gridService.unselect(i.selector(),e.attr("data-id")):i.gridService.select(i.selector(),e.attr("data-id"))),40===t.which){if(t.preventDefault(),r=e.next(),0!==r.length)return i.cursorRow(r.attr("data-id"))}else if(38===t.which&&(t.preventDefault(),r=e.prev(),0!==r.length))return i.cursorRow(r.attr("data-id"))})}return t.prototype.selector=function(){return this.table.selector},t.prototype.header=function(t){var e,r,i,o,n,s,d;for(this.columns=t,r=$("<tr></tr>"),"function"==typeof(i=this.moveMode).beforeHeader&&i.beforeHeader(r),d=this.columns,n=0,s=d.length;s>n;n++)e=d[n],r.append($("<th></th>").attr("data-column-id",e.id).append($("<span></span>").append(e.title))),this.table.find("thead").append(r);return"function"==typeof(o=this.moveMode).afterHeader?o.afterHeader(r):void 0},t.prototype.get=function(t){return this.rows[t]},t.prototype.getById=function(t){return this.rowsById[t]},t.prototype.removeById=function(t){var e;return this.findRow(t).remove,e=this.getById(t),delete this.rowsById[t],e},t.prototype.updateById=function(t,e){var r,i,o,n,s,d,l;for(i=this.rowIdOfGlobal(t),o=$("<tr></tr>").attr("data-id",i),n=$(this.table).find("tr[data-id="+i+"]"),this.getById(i=e),r=0,d=0,l=e.length;l>d;d++)s=e[d],o.append(this.createRowColumn(this.columns[r],s)),r++;return n.html(o.html())},t.prototype.cursorRow=function(t){return void 0===this.currentCursor?this.addClassToRow(t,"current"):(this.removeClassFromRow(this.currentCursor,"current"),this.addClassToRow(t,"current")),this.currentCursor=t},t.prototype.rowIdOfGlobal=function(t){return this.selector().replace("#","")+"_"+t},t.prototype.insert=function(t,e){var r,i,o,n,s,d,l,u;for(void 0===e&&(e=this.guid()),i=this.rowIdOfGlobal(e),o=$("<tr></tr>").attr("data-id",i),"function"==typeof(s=this.moveMode).beforeInsert&&s.beforeInsert(i,o),this.rows[this.numberOfRows++]=t,this.rowsById[e]=t,r=0,l=0,u=t.length;u>l;l++)n=t[l],o.append(this.createRowColumn(this.columns[r],n)),r++;return this.table.find("tbody").append(o),"function"==typeof(d=this.moveMode).afterInsert?d.afterInsert(i,o):void 0},t.prototype.createRowColumn=function(t,e){var r;return r=$("<td></td>"),r.addClass(t).attr("data-column",t.id),r.attr("data-column-editable",t.editable),t.editable===!1&&r.addClass("disabled"),r.append($("<span></span>").append(e))},t.prototype.selectRow=function(t,e){var r,i;return"function"==typeof(r=this.moveMode).beforeRowSelect&&r.beforeRowSelect(t),this.addClassToRow(t,e),"function"==typeof(i=this.moveMode).afterRowSelect?i.afterRowSelect(t):void 0},t.prototype.unselectRow=function(t,e){var r,i;return"function"==typeof(r=this.moveMode).beforeRowUnselect&&r.beforeRowUnselect(t),this.removeClassFromRow(t,e),"function"==typeof(i=this.moveMode).afterRowUnselect?i.afterRowUnselect(t):void 0},t.prototype.addClassToRow=function(t,e){var r;return r=this.findRow(t),r.hasClass(e)?void 0:r.addClass(e)},t.prototype.removeClassFromRow=function(t,e){return this.findRow(t).removeClass(e)},t.prototype.removeAllClassesFromRow=function(t){var e;return e=this.findRow(t),e.removeClass()},t.prototype.toggleClassToRow=function(t,e){return this.findRow(t).toggleClass(e)},t.prototype.hasClassOfRow=function(t,e){return this.findRow(t).hasClass(e)},t.prototype.findRow=function(t){return $(this.table).find("tr[data-id="+t+"]")},t.prototype.listen=function(t,e,r){return this.findRow(t).on(e,function(){return r(t,$(this))})},t.prototype.listenRowEvent=function(t,e){return this.table.on(t,"tr",function(){var t;return t=$(this).attr("data-id"),e(t,$(this))})},t.prototype.toRowEdit=function(t){var e;return e=this.findRow(t)},t.prototype.toCellEdit=function(t,e){var r,i;return i=this.findRow(t),r=i.find("td[data-column="+e+"]"),this.isCellEditable(r)?this._editCell(r):void 0},t.prototype.isCellEditable=function(t){return"true"===t.attr("data-column-editable")},t.prototype._editPreviousCell=function(t){return t=this.searchEditableColumnToBackward(t),t===!1?!1:this.isCellEditable(t)?this._editCell(t):void 0},t.prototype.searchEditableColumnToBackward=function(t,e){var r,i,o;return null==e&&(e=1),e>20?!1:(o=t.prev(),this.isCellEditable(o)?o:0===o.length&&(i=t.parent().prev(),r=i.children().length,o=$(i.children()[r-1]),this.isCellEditable(o))?o:this.searchEditableColumnToBackward(o,e+1))},t.prototype.searchEditableColumnToForward=function(t,e){var r,i;return null==e&&(e=1),e>20?!1:(r=t.next(),this.isCellEditable(r)?r:0===r.length&&(i=t.parent().next(),r=$(i.children()[0]),this.isCellEditable(r))?r:this.searchEditableColumnToForward(r,e+1))},t.prototype._editNextCell=function(t){return t=this.searchEditableColumnToForward(t),t===!1?!1:this.isCellEditable(t)?this._editCell(t):void 0},t.prototype._editCell=function(t){var e,r;return t===!1?!1:(e=$('<input type="text"></input>').val(t.text()),TableUIHelper.fitInputToCell(e,t),t.find("span").replaceWith(e),e.select(),"function"==typeof(r=this.moveMode).move?r.move(e,t):void 0)},t.prototype.listenCellEvent=function(t,e){return this.table.on(t,"td",function(){var t;return t=$(this).parents("tr").attr("data-id"),e(t,$(this))})},t.prototype.listenTextEvent=function(t,e){return this.table.find("span").on(t,function(){var t;return t=$(this).parents("tr").attr("data-id"),e(t,$(this)),!1})},t.prototype.s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},t.prototype.guid=function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},t}(),TableUIHelper=function(){function t(){}return t.fitInputToCell=function(t,e){var r,i,o,n,s,d,l,u,a;return l=parseInt(e.css("paddingLeft"),10),u=parseInt(e.css("paddingRight"),10),a=parseInt(e.css("paddingTop"),10),d=parseInt(e.css("paddingBottom"),10),o=parseInt(e.css("borderLeft"),10),n=parseInt(e.css("borderRight"),10),s=parseInt(e.css("borderTop"),10),i=parseInt(e.css("borderBottom"),10),r=2,t.css("marginLeft",-1*l),t.css("marginRight",-1*u),t.css("marginTop",-1*(a+s+r)),t.css("marginBottom",-1*d),t.width(e.width()+l+u),t.height(e.height()+a+d+s)},t}(),ExcelMoveMode=function(){function t(){}return t.prototype.init=function(t,e,r){var i=this;return this.table=t,this.applicationGridService=e,this.rowSelectedClass=r,this.table.listenCellEvent("click",function(t,e){var r;return r=e.attr("data-column"),i.table.toCellEdit(t,r)})},t.prototype.beforeHeader=function(t){var e,r=this;return e=$("<input></input>").attr("type","checkbox"),e.on("click",function(){var t;return t=$(r),t.prop("checked")?(r.applicationGridService.unselectAll(r.table.selector()),t.prop("checked",!1)):(r.applicationGridService.selectAll(r.table.selector()),t.prop("checked",!0))}),t.append($("<td></td>").append(e))},t.prototype.beforeInsert=function(t,e){var r,i=this;return r=$("<input></input>").attr("type","checkbox"),r.attr("data-row-id",t),r.on("click",function(){return i.table.hasClassOfRow(t,i.rowSelectedClass)?i.applicationGridService.unselect(i.table.selector(),t):i.applicationGridService.select(i.table.selector(),t)}),e.append($("<td></td>").append(r))},t.prototype.beforeRowSelect=function(t){return $("input[data-row-id="+t+"]").prop("checked",!0)},t.prototype.beforeRowUnselect=function(t){return $("input[data-row-id="+t+"]").prop("checked",!1)},t.prototype.move=function(t,e){var r=this;return t.on("keydown",function(i){var o,n,s,d;return 9===i.which&&(i.preventDefault(),t.replaceWith($("<span></span>").text(t.val())),i.shiftKey===!0?r.table._editPreviousCell(e):r.table._editNextCell(e)),13===i.which?(t.replaceWith($("<span></span>").text(t.val())),i.shiftKey===!0?(d=$(e.parent().prev()),s=d.find("td[data-column="+e.attr("data-column")+"]"),r.table._editCell(s)):(n=$(e.parent().next()),o=n.find("td[data-column="+e.attr("data-column")+"]"),r.table._editCell(o))):void 0}),t.on("blur",function(){return t.replaceWith($("<span></span>").text(t.val()))})},t}(),MoveModeFactory=function(){function t(){}return t.classes={excel:ExcelMoveMode,sequence:SequenceMoveMode},t.create=function(t){return new this.classes[t]},t}(),SequenceMoveMode=function(){function t(){}return t.prototype.move=function(t,e,r){return t.on("keypress",function(i){return 13===i.which?(t.replaceWith($("<span></span>").text(t.val())),0===e.next().length?r._editCell($(e.parent().next().find("td")[0])):r._editCell(e.next())):void 0}),t.on("blur",function(){return t.replaceWith($("<span></span>").text(t.val()))})},t}(),AjaxDataSource=function(){function t(t){this.url=t}return t.prototype.retrieve=function(t,e){return $.get(this.url,e,function(e){return t(e)})},t}(),ArrayDataSource=function(){function t(){}return t.prototype.retrieve=function(t){return t([["suin",26],["reoring",300],["nouphet",3e5]])},t}(),ViewController=function(){function t(t,e,r,i,o){var n,s=this;this.grid=t,this.tableSelector=e,this.header=r,this.rowSelectedClass=null!=i?i:"row_selected",n=MoveModeFactory.create(o),this.applicationGridService=new GridService,this.table=new Table($(this.tableSelector),n,this.applicationGridService),this.table.header(r),n.init(this.table,this.applicationGridService,this.rowSelectedClass),DomainEvent.subscribe("GridChanged",function(t){var e,r,i,o,n;if(t.gridId===s.tableSelector){for(o=t.rows,n=[],r=0,i=o.length;i>r;r++)e=o[r],n.push(s.table.insert(e.columns,e.rowId));return n}}),DomainEvent.subscribe("RowAppended",function(t){return t.gridId===s.tableSelector?s.table.insert(t.columns,t.rowId):void 0}),DomainEvent.subscribe("RowSelected",function(t){return t.gridId===s.tableSelector?s.table.selectRow(t.rowId,s.rowSelectedClass):void 0}),DomainEvent.subscribe("RowUnselected",function(t){return t.gridId===s.tableSelector?s.table.unselectRow(t.rowId,s.rowSelectedClass):void 0})}return t.prototype.add=function(t,e){return this.grid.append(new Row(t,e))},t.prototype.selectAll=function(t){return this.applicationGridService.selectAll(t)},t.prototype.unselectAll=function(t){return this.applicationGridService.unselectAll(t)},t.prototype.cursor=function(t){return this.table.cursorRow(t)},t}();